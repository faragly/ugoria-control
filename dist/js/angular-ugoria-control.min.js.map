{"version":3,"sources":["angular-ugoria-control.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","window","angular","jQuery","constant","provider","service","directive","filter","factory","./directives/focus","./directives/ugoria","./factories/cache","./filters/segments","./providers/options","./services/data","./services/keys","./templates",2,"$timeout","scope","trigger","link","element","$watch","value","focus",3,"ugoriaControl","$templateCache","$compile","$parse","$filter","$rootScope","dataService","keysService","options","attrs","refresh","uc","dropdownClicked","target","closest","dropdownElem","is","toggleVisibility","visible","$emit","showDropdown","$apply","on","bind","get","after","document","$on","off","remove","selected","text","restrict","compile","pre","controller","UgoriaCtrl","controllerAs","bindToController","$scope","$element","$attrs","show","evt","vm","dropdownVisible","this","data","hasTail","loading","activeRequest","isFirstRequest","keys","position","offset","next","css","top","outerHeight","left","query","copy","isArray","segments","toLowerCase","indexOf","str","forEach","val","replace","RegExp","trim","isString","split","cancel","request","then","dataResponse","filteredSegments","getRequestInterval","select","elem","id","join","children","$inject",4,"UgoriaCache","$cacheFactory","capacity",5,"items","name","filtered","item","isUndefined","push",6,"rootUrl","requestInterval","setRootUrl","url","setRequestInterval","interval","$get","getRootUrl",7,"$http","$httpParamSerializer","ugoriaCache","result","params","isDefined","serializedParams","console","log","dataType","put",8,"arrows","event","el","parent","find","keyCode","last","first","inner","scrollTop","arr","isLastInColumn","slice","index","each","height","totalColumns","preventDefault","isFirstInColumn","reverse","getLastItemInCoulmn","prev","num","firstElemPositionLeft","col","colElemPositionLeft",9,"run"],"mappings":"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","file":"angular-ugoria-control.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n(function(window, angular, jQuery) {\n  'use strict';\n  \n  var templates = angular.module('templates', []);\n  require('./templates');\n\n  var myapp = angular.module('ngUgoriaControl', ['templates'])\n  \t.constant('MODULE_VERSION', '1.0')\n  \t.provider('options', require('./providers/options'))\n  \t.service('dataService', require('./services/data'))\n  \t.service('keysService', require('./services/keys'))\n  \t.directive('focus', require('./directives/focus'))\n  \t.directive('ugoriaControl', require('./directives/ugoria'))\n  \t.filter('filteredSegments', require('./filters/segments'))\n  \t.factory('ugoriaCache', require('./factories/cache'));\n})(window, window.angular, window.jQuery);\n},{\"./directives/focus\":2,\"./directives/ugoria\":3,\"./factories/cache\":4,\"./filters/segments\":5,\"./providers/options\":6,\"./services/data\":7,\"./services/keys\":8,\"./templates\":9}],2:[function(require,module,exports){\nmodule.exports = ['$timeout', function ($timeout) {\n  return {\n    scope : {\n      trigger : '@focus'\n    },\n    link : function(scope, element) {\n      scope.$watch('trigger', function(value) {\n        if (value === \"true\") {\n          $timeout(function() {\n            element[0].focus();\n          });\n        }\n      });\n    }\n  };\n}];\n},{}],3:[function(require,module,exports){\nfunction ugoriaControl($templateCache, $compile, $parse, $timeout, $filter, $rootScope, dataService, keysService, options) {\n  var directive = {\n    scope: {\n      selected: '=ucSelected',\n      text: '=ngModel'\n    },\n    restrict: 'EA',\n    compile: function (){\n      return {\n        pre: link\n      };\n    },\n    controller: UgoriaCtrl,\n    controllerAs: 'uc',\n    bindToController: true\n  };\n  return directive;\n\n  function link(scope, element, attrs) {\n    // var dropdownScope = scope.$new(true);\n    element.on('focus', toggleVisibility.bind(null, true));\n    element.on('keyup', refresh);\n    \n    var dropdownElem = angular.element($templateCache.get('dropdown.html'));\n    element.after(dropdownElem);\n    $compile(dropdownElem)(scope);\n    angular.element(document).on(\"click\", dropdownClicked);\n\n    scope.$on('$destroy', function (){\n      element.off('focus', toggleVisibility);\n      element.off('keyup', refresh);\n      angular.element(document).off(\"click\", dropdownClicked);\n      dropdownElem.remove();\n    });\n    \n    // вызывается при событии keyup при вводе с клавиатуры\n    function refresh(e) {\n      scope.uc.refresh(true);\n    }\n\n    // вызывается при клике на документе, если клик не на dropdown или фокус не на текстовом поле, то скрываем dropdown\n    function dropdownClicked(e) {\n      if (jQuery(e.target).closest(dropdownElem).is(dropdownElem) === false && jQuery(element).is(':focus') === false) {\n        toggleVisibility(false);\n      }\n    }\n\n    // скрываем или показываем dropdown\n    function toggleVisibility(visible){        \n      scope.$emit('dropdown:show', visible);\n      if(visible)\n        scope.uc.showDropdown();\n      scope.$apply();\n    }\n  }    \n}\n\nUgoriaCtrl.$inject = ['$scope', '$element', '$attrs', '$parse', '$filter', '$timeout', 'dataService', 'keysService', 'options'];\nfunction UgoriaCtrl($scope, $element, $attrs, $parse, $filter, $timeout, dataService, keysService, options) {\n  var vm = this;\n  var cancel = $scope.$on('dropdown:show', show);\n  vm.data = null;\n  vm.hasTail = false;\n  vm.dropdownVisible = false;\n  vm.selected = {};\n  vm.loading = false;\n  var activeRequest = null,\n    isFirstRequest = true;\n  vm.keys = keysService;\n      \n  function show(evt, visible) {\n    vm.dropdownVisible = visible;\n  }\n\n  /* показываем диалог и позиционируем под input'ом */\n  vm.showDropdown = function() {\n    var position = jQuery($element).offset();\n    jQuery($element).next().css({\n      top: position.top + jQuery($element).outerHeight(),\n      left: position.left\n    });\n    vm.refresh(vm.hasTail);\n  };\n\n  /*\n    Функция обновления запроса, при пустых входных данных загружает /api/Data без параметров\n    изменяя input каждый раз вызывается и соответственно если выбрать элемент BMW и начать удалять, то при BM содержимое selected обнулится\n    немного доработан разбор строки, если вручную ввести bmw 3, то запрос уйдет /api/Data?query[]=bmw&query[]=3&hasTail=true, а не /api/Data?query[]=bmw%203&hasTail=true\n    запросы отправляются не чаще чем каждые 250ms\n  */\n  vm.refresh = function(hasTail, query) {\n    var value = angular.copy(vm.text);\n    vm.hasTail = hasTail || false;\n    query = query || value;\n    vm.loading = true;\n    if (angular.isArray(vm.selected.segments) && value.toLowerCase().indexOf(vm.selected.segments[0].toLowerCase()) === -1)\n      vm.selected = {};\n    else if (angular.isArray(vm.selected.segments) && value.length > 0) {\n      var str = angular.copy(value);\n      angular.forEach(vm.selected.segments, function(val) {\n        str = str.replace(new RegExp(val, 'i'), '').trim();\n      });\n      if (str.length > 0)\n        query = [vm.selected.segments[0], str];\n    }\n    if (angular.isString(query) && query.length > 0)\n      query = query.split(' ');\n    if (activeRequest) $timeout.cancel(activeRequest);\n    activeRequest = $timeout(function() {\n      dataService.request(query, vm.hasTail).then(function(dataResponse) {\n        vm.data = dataResponse.data;\n        if(isFirstRequest) {\n          vm.filteredSegments = $filter('filteredSegments')(vm.data);\n          isFirstRequest = false;\n        }\n        vm.loading = false;\n      });\n    }, options.getRequestInterval());\n  };\n\n  /* выбираем элемент, если он с ID то скрываем dropdown окно */\n  vm.select = function(elem) {\n    if (angular.isString(elem)) {\n      elem = {\n        segments: [elem]\n      };\n    }\n    if (elem.id > 0 && elem.segments.length > 1)\n      vm.dropdownVisible = false;\n    vm.hasTail = false;\n    vm.selected = elem;\n    vm.text = elem.segments.join(' ');\n    angular.element($element).val(elem.segments.join(' '));\n    vm.refresh(vm.hasTail, elem.segments);\n    jQuery($element).next().children('.dropdown__inner').focus();\n  };\n}\n\nmodule.exports = ['$templateCache', '$compile', '$parse', '$timeout', '$filter', '$rootScope', 'dataService', 'keysService', ugoriaControl];\n},{}],4:[function(require,module,exports){\nfunction UgoriaCache($cacheFactory) {\n  return $cacheFactory('ugoriaCache', {capacity: 10});\n}\n\nmodule.exports = ['$cacheFactory', UgoriaCache];\n},{}],5:[function(require,module,exports){\nfunction filteredSegments() {\n   return function(items, name) {\n    var filtered = [];\n    name = name || '';\n    angular.forEach(items, function(item) {\n      if(angular.isUndefined(item.id) || item.id === null){\n        filtered.push(item.segments[0]);\n      }\n    });\n    return filtered;\n  };\n}\n\nmodule.exports = [filteredSegments];\n},{}],6:[function(require,module,exports){\nfunction options() {\n  var rootUrl = 'http://phwebpro.azurewebsites.net/api/Data',\n    requestInterval = 250;\n  this.setRootUrl = function(url) {\n    rootUrl = url;\n    return this; // Fluent interface, тут к месту.\n  };     \n  this.setRequestInterval = function(interval) {\n    requestInterval = interval;\n    return this;\n  };     \n  this.$get = function() {\n    return {\n      getRequestInterval: function() { return requestInterval; },\n      getRootUrl: function() { return rootUrl; }\n    };\n  };\n}\n\nmodule.exports = [options];\n},{}],7:[function(require,module,exports){\nfunction dataService($http, $httpParamSerializer, ugoriaCache, options) {\n  this.request = function (query, hasTail) {\n    var result,\n      params = {};\n    params['query[]'] = query || [];\n    if (angular.isDefined(hasTail) && hasTail && params['query[]'].length) params.hasTail = true;\n    //console.log($httpParamSerializer(params));\n    var serializedParams = $httpParamSerializer(params);\n    if(ugoriaCache.get(serializedParams)) {\n      result = ugoriaCache.get(serializedParams);\n      console.log('Запрос не выполнен, данные взяты из кэша.');\n    } else {\n      result = $http.get(options.getRootUrl(), {\n        dataType: 'jsonp',\n        params: params \n      });\n      ugoriaCache.put(serializedParams, result);\n      console.log('Запрос выполнен, данные помещены в кэш.');\n    }\n    return result;\n  };\n}\n\nmodule.exports = ['$http', '$httpParamSerializer', 'ugoriaCache', 'options', dataService];\n},{}],8:[function(require,module,exports){\nfunction keysService() {\n  var service = {\n    arrows: arrows\n  };\n  return service;\n\n  /* функция нажатия стрелок вверх вниз влево вправо\n  * что поддерживается:\n  * перемещение из конца одной колонки в начало следующей (вниз)\n  * из конца последней в начало первой (вниз)\n  * из начала одной колонки в конец предыдущей (вверх)\n  * из начала первой колонки в конец последней (вверх)\n  * вправо влево попроще, так как элементы выстраиваются горизонтально, то есть достаточно перехода к предыдущему или следующему элементу набора\n  * во всех случаях корректируется положение скроллинга, так чтобы фокусируемый элемент был в зоне видимости\n  */\n  function arrows(event) {\n    var items = jQuery('.dropdown--show .dropdown__inner-content .content > .flex-container > .item:visible'),\n      item = items.parent().find('.item:has(a:focus)').length ? items.parent().find('.item:has(a:focus)') : event.keyCode == 40 ? items.last() : items.first(),\n      inner = jQuery('.dropdown--show > .dropdown__inner-content'),\n      scrollTop = inner.scrollTop(),\n      arr = [],\n      el;\n    switch (event.keyCode) {\n    case 40:\n      var isLastInColumn = true;\n      arr = items.slice(item.index() + 1);\n      if (item.index() == items.length - 1) {\n        items.first().children('a').focus();\n        inner.scrollTop(0);\n      }\n      jQuery.each(arr, function (index, element) {\n        el = jQuery(element);\n        if (el.position().left == item.position().left) {\n          el.children('a').focus();\n          if (el.position().top + el.outerHeight() > inner.height()) inner.scrollTop(scrollTop + el.outerHeight());\n          isLastInColumn = false;\n          return false;\n        }\n      });\n      if (arr.length && isLastInColumn) {\n        el = jQuery(items.get((item.index() % totalColumns(items.slice(0, 10))) + 1));\n        el.children('a').focus();\n        if (el.position().top + el.outerHeight() < 0) inner.scrollTop(0);\n      }\n      event.preventDefault();\n      break;\n    case 38:\n      var isFirstInColumn = true;\n      arr = items.slice(0, item.index());\n      if (item.index() === 0) {\n        el = items.last();\n        el.children('a').focus();\n        if (el.position().top < 0) inner.scrollTop(scrollTop + el.position().top - el.outerHeight());\n      }\n      jQuery.each(arr.get().reverse(), function (index, element) {\n        el = jQuery(element);\n        if (el.position().left == item.position().left) {\n          el.children('a').focus();\n          var scrollTop = inner.scrollTop();\n          if (el.position().top < 0) inner.scrollTop(scrollTop + el.position().top - el.outerHeight());\n          isFirstInColumn = false;\n          return false;\n        }\n      });\n      if (arr.length && isFirstInColumn) {\n        var i = getLastItemInCoulmn(items, item.index() % totalColumns(items.slice(0, 10)));\n        el = jQuery(items.get(i));\n        el.children('a').focus();\n        if (el.position().top + el.outerHeight() > inner.height()) inner.scrollTop(el.position().top + el.outerHeight());\n      }\n      event.preventDefault();\n      break;\n    case 37:\n      el = item.index() === 0 ? items.last() : item.prev();\n      el.children('a').focus();\n      if (el.position().top + el.outerHeight() > inner.height()) {\n        inner.scrollTop(scrollTop + el.position().top + el.outerHeight());\n      } else if (el.position().top < 0) inner.scrollTop(scrollTop - el.outerHeight());\n      break;\n    case 39:\n      el = item.index() == items.length - 1 ? items.first() : item.next();\n      el.children('a').focus();\n      if (el.position().top + el.outerHeight() > inner.height()) inner.scrollTop(scrollTop + el.outerHeight());\n      else if (el.position().top < 0) inner.scrollTop(0);\n      break;\n    }\n  }\n\n  // функция высчитывает количество колонок\n  function totalColumns(items) {\n    var num = 0,\n      firstElemPositionLeft = null;\n    jQuery.each(items, function (index, element) {\n      el = jQuery(element);\n      if (index === 0) firstElemPositionLeft = el.position().left;\n      if (el.position().left == firstElemPositionLeft && index) {\n        return false;\n      }\n      num++;\n    });\n    return num;\n  }\n\n  // функция возвращает индекс последнего элемента в колонке col\n  function getLastItemInCoulmn(items, col) {\n    var i = 0,\n      colElemPositionLeft = jQuery(items.get(col - 1)).position().left;\n    jQuery.each(items, function (index, element) {\n      if (jQuery(element).position().left == colElemPositionLeft) i = index;\n    });\n    return i;\n  }\n}\nmodule.exports = [keysService];\n},{}],9:[function(require,module,exports){\n'use strict'; module.exports = angular.module(\"templates\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"dropdown.html\",\"\\n<div data-ng-class=\\\"{\\'dropdown--show\\': uc.dropdownVisible}\\\" class=\\\"dropdown\\\">\\n  <div tabindex=\\\"0\\\" data-ng-keydown=\\\"uc.keys.arrows($event)\\\" class=\\\"dropdown__inner\\\">\\n    <div class=\\\"dropdown__inner-content\\\">\\n      <div class=\\\"flex-container\\\">\\n        <div data-ng-if=\\\"uc.loading\\\" role=\\\"spinner\\\" class=\\\"spinner\\\">\\n          <div class=\\\"spinner__icon\\\"></div>\\n        </div>\\n        <nav data-ng-hide=\\\"!((uc.selected.segments[0] &amp;&amp; uc.hasTail) || uc.text.length)\\\">\\n          <ul class=\\\"menu\\\">\\n            <li data-ng-repeat=\\\"item in uc.filteredSegments track by $index\\\" data-ng-class=\\\"{\\'menu__item--active\\': item == uc.selected.segments[0]}\\\" class=\\\"menu__item\\\"><a href=\\\"#\\\" data-ng-click=\\\"item != uc.selected.segments[0] ? uc.select(item) : null\\\">{{item}}</a></li>\\n          </ul>\\n        </nav>\\n        <div class=\\\"content\\\">\\n          <div data-ng-hide=\\\"uc.loading\\\" class=\\\"flex-container\\\"> \\n            <div data-ng-if=\\\"!uc.data.length\\\">Ничего не найдено.</div>\\n            <div data-ng-repeat=\\\"elem in uc.data track by $index\\\" data-ng-hide=\\\"elem.id === null &amp;&amp; uc.selected.segments.length &lt; 2\\\" class=\\\"item\\\"><a href=\\\"#\\\" data-ng-click=\\\"uc.select(elem)\\\" tabindex=\\\"{{$index+1}}\\\">{{elem.id ? elem.segments[1] : elem.segments[0]}}</a></div>\\n          </div>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</div>\");}]);\n},{}]},{},[1]);\n"],"sourceRoot":"/source/"}