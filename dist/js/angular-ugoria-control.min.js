!function e(t,n,o){function i(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return i(n?n:e)},u,u.exports,e,t,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,n){!function(t,n,o){"use strict";n.module("templates",[]);e("./templates");n.module("ngUgoriaControl",["templates"]).constant("MODULE_VERSION","1.0").provider("options",e("./providers/options")).service("dataService",e("./services/data")).service("keysService",e("./services/keys")).directive("focus",e("./directives/focus")).directive("ugoriaControl",e("./directives/ugoria")).filter("filteredSegments",e("./filters/segments")).factory("ugoriaCache",e("./factories/cache"))}(window,window.angular,window.jQuery)},{"./directives/focus":2,"./directives/ugoria":3,"./factories/cache":4,"./filters/segments":5,"./providers/options":6,"./services/data":7,"./services/keys":8,"./templates":9}],2:[function(e,t,n){t.exports=["$timeout",function(e){return{scope:{trigger:"@focus"},link:function(t,n){t.$watch("trigger",function(t){"true"===t&&e(function(){n[0].focus()})})}}}]},{}],3:[function(e,t,n){function o(e,t,n,o,r,s,a,c,l){function u(n,o,i){function r(e){n.uc.refresh(!0)}function s(e){jQuery(e.target).closest(c).is(c)===!1&&jQuery(o).is(":focus")===!1&&a(!1)}function a(e){n.$emit("dropdown:show",e),e&&n.uc.showDropdown(),n.$apply()}o.on("focus",a.bind(null,!0)),o.on("keyup",r);var c=angular.element(e.get("dropdown.html"));o.after(c),t(c)(n),angular.element(document).on("click",s),n.$on("$destroy",function(){o.off("focus",a),o.off("keyup",r),angular.element(document).off("click",s),c.remove()})}var d={scope:{selected:"=ucSelected",text:"=ngModel"},restrict:"EA",compile:function(){return{pre:u}},controller:i,controllerAs:"uc",bindToController:!0};return d}function i(e,t,n,o,i,r,s,a,c){function l(e,t){u.dropdownVisible=t}{var u=this;e.$on("dropdown:show",l)}u.data=null,u.hasTail=!1,u.dropdownVisible=!1,u.selected={},u.loading=!1;var d=null,p=!0;u.keys=a,u.showDropdown=function(){var e=jQuery(t).offset();jQuery(t).next().css({top:e.top+jQuery(t).outerHeight(),left:e.left}),u.refresh(u.hasTail)},u.refresh=function(e,t){var n=angular.copy(u.text);if(u.hasTail=e||!1,t=t||n,u.loading=!0,angular.isArray(u.selected.segments)&&-1===n.toLowerCase().indexOf(u.selected.segments[0].toLowerCase()))u.selected={};else if(angular.isArray(u.selected.segments)&&n.length>0){var o=angular.copy(n);angular.forEach(u.selected.segments,function(e){o=o.replace(new RegExp(e,"i"),"").trim()}),o.length>0&&(t=[u.selected.segments[0],o])}angular.isString(t)&&t.length>0&&(t=t.split(" ")),d&&r.cancel(d),d=r(function(){s.request(t,u.hasTail).then(function(e){u.data=e.data,p&&(u.filteredSegments=i("filteredSegments")(u.data),p=!1),u.loading=!1})},c.getRequestInterval())},u.select=function(e){angular.isString(e)&&(e={segments:[e]}),e.id>0&&e.segments.length>1&&(u.dropdownVisible=!1),u.hasTail=!1,u.selected=e,u.text=e.segments.join(" "),angular.element(t).val(e.segments.join(" ")),u.refresh(u.hasTail,e.segments),jQuery(t).next().children(".dropdown__inner").focus()}}i.$inject=["$scope","$element","$attrs","$parse","$filter","$timeout","dataService","keysService","options"],t.exports=["$templateCache","$compile","$parse","$timeout","$filter","$rootScope","dataService","keysService",o]},{}],4:[function(e,t,n){function o(e){return e("ugoriaCache",{capacity:10})}t.exports=["$cacheFactory",o]},{}],5:[function(e,t,n){function o(){return function(e,t){var n=[];return t=t||"",angular.forEach(e,function(e){(angular.isUndefined(e.id)||null===e.id)&&n.push(e.segments[0])}),n}}t.exports=[o]},{}],6:[function(e,t,n){function o(){var e="http://phwebpro.azurewebsites.net/api/Data",t=250;this.setRootUrl=function(t){return e=t,this},this.setRequestInterval=function(e){return t=e,this},this.$get=function(){return{getRequestInterval:function(){return t},getRootUrl:function(){return e}}}}t.exports=[o]},{}],7:[function(e,t,n){function o(e,t,n,o){this.request=function(i,r){var s,a={};a["query[]"]=i||[],angular.isDefined(r)&&r&&a["query[]"].length&&(a.hasTail=!0);var c=t(a);return n.get(c)?(s=n.get(c),console.log("Запрос не выполнен, данные взяты из кэша.")):(s=e.get(o.getRootUrl(),{dataType:"jsonp",params:a}),n.put(c,s),console.log("Запрос выполнен, данные помещены в кэш.")),s}}t.exports=["$http","$httpParamSerializer","ugoriaCache","options",o]},{}],8:[function(e,t,n){function o(){function e(e){var o,i=jQuery(".dropdown--show .dropdown__inner-content .content > .flex-container > .item:visible"),r=i.parent().find(".item:has(a:focus)").length?i.parent().find(".item:has(a:focus)"):40==e.keyCode?i.last():i.first(),s=jQuery(".dropdown--show > .dropdown__inner-content"),a=s.scrollTop(),c=[];switch(e.keyCode){case 40:var l=!0;c=i.slice(r.index()+1),r.index()==i.length-1&&(i.first().children("a").focus(),s.scrollTop(0)),jQuery.each(c,function(e,t){return o=jQuery(t),o.position().left==r.position().left?(o.children("a").focus(),o.position().top+o.outerHeight()>s.height()&&s.scrollTop(a+o.outerHeight()),l=!1,!1):void 0}),c.length&&l&&(o=jQuery(i.get(r.index()%t(i.slice(0,10))+1)),o.children("a").focus(),o.position().top+o.outerHeight()<0&&s.scrollTop(0)),e.preventDefault();break;case 38:var u=!0;if(c=i.slice(0,r.index()),0===r.index()&&(o=i.last(),o.children("a").focus(),o.position().top<0&&s.scrollTop(a+o.position().top-o.outerHeight())),jQuery.each(c.get().reverse(),function(e,t){if(o=jQuery(t),o.position().left==r.position().left){o.children("a").focus();var n=s.scrollTop();return o.position().top<0&&s.scrollTop(n+o.position().top-o.outerHeight()),u=!1,!1}}),c.length&&u){var d=n(i,r.index()%t(i.slice(0,10)));o=jQuery(i.get(d)),o.children("a").focus(),o.position().top+o.outerHeight()>s.height()&&s.scrollTop(o.position().top+o.outerHeight())}e.preventDefault();break;case 37:o=0===r.index()?i.last():r.prev(),o.children("a").focus(),o.position().top+o.outerHeight()>s.height()?s.scrollTop(a+o.position().top+o.outerHeight()):o.position().top<0&&s.scrollTop(a-o.outerHeight());break;case 39:o=r.index()==i.length-1?i.first():r.next(),o.children("a").focus(),o.position().top+o.outerHeight()>s.height()?s.scrollTop(a+o.outerHeight()):o.position().top<0&&s.scrollTop(0)}}function t(e){var t=0,n=null;return jQuery.each(e,function(e,o){return el=jQuery(o),0===e&&(n=el.position().left),el.position().left==n&&e?!1:void t++}),t}function n(e,t){var n=0,o=jQuery(e.get(t-1)).position().left;return jQuery.each(e,function(e,t){jQuery(t).position().left==o&&(n=e)}),n}var o={arrows:e};return o}t.exports=[o]},{}],9:[function(e,t,n){"use strict";t.exports=angular.module("templates").run(["$templateCache",function(e){e.put("dropdown.html",'\n<div data-ng-class="{\'dropdown--show\': uc.dropdownVisible}" class="dropdown">\n  <div tabindex="0" data-ng-keydown="uc.keys.arrows($event)" class="dropdown__inner">\n    <div class="dropdown__inner-content">\n      <div class="flex-container">\n        <div data-ng-if="uc.loading" role="spinner" class="spinner">\n          <div class="spinner__icon"></div>\n        </div>\n        <nav data-ng-hide="!((uc.selected.segments[0] &amp;&amp; uc.hasTail) || uc.text.length)">\n          <ul class="menu">\n            <li data-ng-repeat="item in uc.filteredSegments track by $index" data-ng-class="{\'menu__item--active\': item == uc.selected.segments[0]}" class="menu__item"><a href="#" data-ng-click="item != uc.selected.segments[0] ? uc.select(item) : null">{{item}}</a></li>\n          </ul>\n        </nav>\n        <div class="content">\n          <div data-ng-hide="uc.loading" class="flex-container"> \n            <div data-ng-if="!uc.data.length">Ничего не найдено.</div>\n            <div data-ng-repeat="elem in uc.data track by $index" data-ng-hide="elem.id === null &amp;&amp; uc.selected.segments.length &lt; 2" class="item"><a href="#" data-ng-click="uc.select(elem)" tabindex="{{$index+1}}">{{elem.id ? elem.segments[1] : elem.segments[0]}}</a></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>')}])},{}]},{},[1]);
//# sourceMappingURL=angular-ugoria-control.min.js.map