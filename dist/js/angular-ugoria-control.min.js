!function e(t,n,i){function o(s,c){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return o(n?n:e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){!function(t,n,i){"use strict";n.module("templates",[]);e("./templates");n.module("ngUgoriaControl",["templates"]).constant("MODULE_VERSION","1.0").provider("options",e("./providers/options")).service("dataService",e("./services/data")).service("keysService",e("./services/keys")).directive("focus",e("./directives/focus")).directive("ugoriaControl",e("./directives/ugoria")).filter("filteredSegments",e("./filters/segments")).factory("ugoriaCache",e("./factories/cache"))}(window,window.angular,window.jQuery)},{"./directives/focus":2,"./directives/ugoria":3,"./factories/cache":4,"./filters/segments":5,"./providers/options":6,"./services/data":7,"./services/keys":8,"./templates":9}],2:[function(e,t,n){t.exports=["$timeout",function(e){return{scope:{trigger:"@focus"},link:function(t,n){t.$watch("trigger",function(t){"true"===t&&e(function(){n[0].focus()})})}}}]},{}],3:[function(e,t,n){function i(e,t,n,i,r,s,c,a,l){function u(n,i,o){function r(e){n.uc.refresh(!0)}function s(e){jQuery(e.target).closest(a).is(a)===!1&&jQuery(i).is(":focus")===!1&&c(!1)}function c(e){n.$emit("dropdown:show",e),e&&n.uc.showDropdown(),n.$apply()}i.on("focus",c.bind(null,!0)),i.on("keyup",r);var a=angular.element(e.get("dropdown.html"));i.after(a),t(a)(n),angular.element(document).on("click",s),n.$on("$destroy",function(){i.off("focus",c),i.off("keyup",r),angular.element(document).off("click",s),a.remove()})}var d={scope:{selected:"=ucSelected",text:"=ngModel"},restrict:"EA",compile:function(){return{pre:u}},controller:o,controllerAs:"uc",bindToController:!0};return d}function o(e,t,n,i,o,r,s,c,a){function l(e,t){u.dropdownVisible=t}{var u=this;e.$on("dropdown:show",l)}u.data=null,u.hasTail=!1,u.dropdownVisible=!1,u.selected={},u.loading=!1;var d=null,f=!0;u.keys=c,u.showDropdown=function(){var e=jQuery(t).offset();jQuery(t).next().css({top:e.top+jQuery(t).outerHeight(),left:e.left}),u.refresh(u.hasTail)},u.refresh=function(e,t){var n=angular.copy(u.text);if(u.hasTail=e||!1,t=t||n,u.loading=!0,angular.isArray(u.selected.segments)&&-1===n.toLowerCase().indexOf(u.selected.segments[0].toLowerCase()))u.selected={};else if(angular.isArray(u.selected.segments)&&n.length>0){var i=angular.copy(n);angular.forEach(u.selected.segments,function(e){i=i.replace(new RegExp(e,"i"),"").trim()}),i.length>0&&(t=[u.selected.segments[0],i])}angular.isString(t)&&t.length>0&&(t=t.split(" ")),d&&r.cancel(d),d=r(function(){s.request(t,u.hasTail).then(function(e){u.data=e.data,f&&(u.filteredSegments=o("filteredSegments")(u.data),f=!1),u.loading=!1})},a.getRequestInterval())},u.select=function(e){angular.isString(e)&&(e={segments:[e]}),e.id>0&&e.segments.length>1&&(u.dropdownVisible=!1),u.hasTail=!1,u.selected=e,u.text=e.segments.join(" "),angular.element(t).val(e.segments.join(" ")),u.refresh(u.hasTail,e.segments),jQuery(t).next().children(".inner").focus()}}o.$inject=["$scope","$element","$attrs","$parse","$filter","$timeout","dataService","keysService","options"],t.exports=["$templateCache","$compile","$parse","$timeout","$filter","$rootScope","dataService","keysService",i]},{}],4:[function(e,t,n){function i(e){return e("ugoriaCache",{capacity:10})}t.exports=["$cacheFactory",i]},{}],5:[function(e,t,n){function i(){return function(e,t){var n=[];return t=t||"",angular.forEach(e,function(e){(angular.isUndefined(e.id)||null===e.id)&&n.push(e.segments[0])}),n}}t.exports=[i]},{}],6:[function(e,t,n){function i(){var e="http://phwebpro.azurewebsites.net/api/Data",t=250;this.setRootUrl=function(t){return e=t,this},this.setRequestInterval=function(e){return t=e,this},this.$get=function(){return{getRequestInterval:function(){return t},getRootUrl:function(){return e}}}}t.exports=[i]},{}],7:[function(e,t,n){function i(e,t,n,i){this.request=function(o,r){var s,c={};c["query[]"]=o||[],angular.isDefined(r)&&r&&c["query[]"].length&&(c.hasTail=!0);var a=t(c);return n.get(a)?(s=n.get(a),console.log("Запрос не выполнен, данные взяты из кэша.")):(s=e.get(i.getRootUrl(),{dataType:"jsonp",params:c}),n.put(a,s),console.log("Запрос выполнен, данные помещены в кэш.")),s}}t.exports=["$http","$httpParamSerializer","ugoriaCache","options",i]},{}],8:[function(e,t,n){function i(){function e(e){var i,o=jQuery(".dropdown.show .content > .flex-container > .item:visible"),r=o.parent().find(".item:has(a:focus)").length?o.parent().find(".item:has(a:focus)"):40==e.keyCode?o.last():o.first(),s=jQuery(".dropdown.show > .inner"),c=s.scrollTop(),a=[];switch(e.keyCode){case 40:var l=!0;a=o.slice(r.index()+1),r.index()==o.length-1&&(o.first().children("a").focus(),s.scrollTop(0)),jQuery.each(a,function(e,t){return i=jQuery(t),i.position().left==r.position().left?(i.children("a").focus(),i.position().top+i.outerHeight()>s.height()&&s.scrollTop(c+i.outerHeight()),l=!1,!1):void 0}),a.length&&l&&(i=jQuery(o.get(r.index()%t(o.slice(0,10))+1)),i.children("a").focus(),i.position().top+i.outerHeight()<0&&s.scrollTop(0)),e.preventDefault();break;case 38:var u=!0;if(a=o.slice(0,r.index()),0===r.index()&&(i=o.last(),i.children("a").focus(),i.position().top<0&&s.scrollTop(c+i.position().top-i.outerHeight())),jQuery.each(a.get().reverse(),function(e,t){if(i=jQuery(t),i.position().left==r.position().left){i.children("a").focus();var n=s.scrollTop();return i.position().top<0&&s.scrollTop(n+i.position().top-i.outerHeight()),u=!1,!1}}),a.length&&u){var d=n(o,r.index()%t(o.slice(0,10)));i=jQuery(o.get(d)),i.children("a").focus(),i.position().top+i.outerHeight()>s.height()&&s.scrollTop(i.position().top+i.outerHeight())}e.preventDefault();break;case 37:i=0===r.index()?o.last():r.prev(),i.children("a").focus(),i.position().top+i.outerHeight()>s.height()?s.scrollTop(c+i.position().top+i.outerHeight()):i.position().top<0&&s.scrollTop(c-i.outerHeight());break;case 39:i=r.index()==o.length-1?o.first():r.next(),i.children("a").focus(),i.position().top+i.outerHeight()>s.height()?s.scrollTop(c+i.outerHeight()):i.position().top<0&&s.scrollTop(0)}}function t(e){var t=0,n=null;return jQuery.each(e,function(e,i){return el=jQuery(i),0===e&&(n=el.position().left),el.position().left==n&&e?!1:void t++}),t}function n(e,t){var n=0,i=jQuery(e.get(t-1)).position().left;return jQuery.each(e,function(e,t){jQuery(t).position().left==i&&(n=e)}),n}var i={arrows:e};return i}t.exports=[i]},{}],9:[function(e,t,n){"use strict";t.exports=angular.module("templates").run(["$templateCache",function(e){e.put("dropdown.html",'\n<div ng-class="{show: uc.dropdownVisible}" class="dropdown bottom">\n  <div tabindex="0" ng-keydown="uc.keys.arrows($event)" class="inner">\n    <div class="dropdown-content">\n      <div class="flex-container">\n        <div ng-if="uc.loading" role="spinner" class="spinner">\n          <div class="spinner-icon"></div>\n        </div>\n        <nav ng-hide="!((uc.selected.segments[0] &amp;&amp; uc.hasTail) || uc.text.length)" class="tabs-left">\n          <ul class="nav nav-tabs">\n            <li ng-repeat="item in uc.filteredSegments track by $index" ng-class="{active: item == uc.selected.segments[0]}"><a href="#" ng-click="item != uc.selected.segments[0] ? uc.select(item) : null">{{item}}</a></li>\n          </ul>\n        </nav>\n        <div class="content clearfix">\n          <div ng-hide="uc.loading" class="flex-container"> \n            <div ng-if="!uc.data.length">Ничего не найдено.</div>\n            <div ng-repeat="elem in uc.data track by $index" ng-hide="elem.id === null &amp;&amp; uc.selected.segments.length &lt; 2" class="item"> <a href="#" ng-click="uc.select(elem)" tabindex="{{$index+1}}">{{elem.id ? elem.segments[1] : elem.segments[0]}}</a>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>')}])},{}]},{},[1]);
//# sourceMappingURL=angular-ugoria-control.min.js.map